<!DOCTYPE html>
<html lang="en" data-theme="{% if current_user.is_authenticated %}{{ current_user.theme_preference or 'dark' }}{% else %}dark{% endif %}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Restaurant POS{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    {% block styles %}{% endblock %}
    <style>
        /* Ensure dark theme is applied immediately */
        html, body {
            background-color: #1e1e1e !important;
            color: #ffffff !important;
        }
        
        /* IMMEDIATE NAVBAR GOLD THEME - Applied instantly */
        .navbar, .navbar-dark, .navbar-light, .navbar.bg-primary {
            background-color: #Ffdb58 !important; /* Gold background */
            border-bottom: 2px solid #daa520 !important; /* Darker gold border */
        }
        
        /* NAVBAR TEXT - Dark text on mustard for high visibility */
        .navbar .navbar-brand, .navbar .nav-link,
        .navbar-dark .navbar-brand, .navbar-dark .nav-link,
        .navbar-light .navbar-brand, .navbar-light .nav-link {
            color: #1e1e1e !important; /* Dark text for contrast */
            font-weight: 600 !important;
            text-shadow: none !important;
        }
        
        /* NAVBAR HOVER EFFECTS */
        .navbar .nav-link:hover,
        .navbar-dark .nav-link:hover, .navbar-light .nav-link:hover {
            color: #000000 !important; /* Pure black on hover */
            background-color: rgba(255, 219, 88, 0.3) !important;
            border-radius: 6px !important;
        }
        
        /* NAVBAR MOBILE TOGGLE */
        .navbar-toggler {
            border-color: #1e1e1e !important;
        }
        
        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%2830, 30, 30, 1%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='m4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
        }
        
        /* Ensure all containers have dark background */
        .container, .container-fluid {
            background-color: transparent !important;
        }
        
        /* MOBILE NAVIGATION ALIGNMENT FIX */
        @media (max-width: 991.98px) {
            /* Ensure mobile navigation links are left-aligned */
            .navbar-collapse .navbar-nav {
                text-align: left !important;
            }
            
            .navbar-collapse .navbar-nav .nav-item {
                text-align: left !important;
            }
            
            .navbar-collapse .navbar-nav .nav-link {
                text-align: left !important;
                padding-left: 1rem !important;
                justify-content: flex-start !important;
                display: flex !important;
                align-items: center !important;
            }
            
            /* Ensure dropdown menu is also left-aligned on mobile */
            .navbar-collapse .dropdown-menu {
                text-align: left !important;
                margin-left: 1rem !important;
            }
            
            .navbar-collapse .dropdown-item {
                text-align: left !important;
                padding-left: 1.5rem !important;
            }
        }
        
        /* THEME SWITCHER BUTTON */
        .theme-switcher {
            background: linear-gradient(135deg, #f39c12, #e67e22) !important;
            border: none !important;
            color: white !important;
            padding: 8px 12px !important;
            border-radius: 8px !important;
            font-size: 0.9rem !important;
            font-weight: 600 !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3) !important;
            margin-left: 10px !important;
        }
        
        .theme-switcher:hover {
            background: linear-gradient(135deg, #e67e22, #d35400) !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4) !important;
        }
        
        .theme-switcher:active {
            transform: translateY(0) !important;
        }
        
        /* MODAL THEME STYLES - Based on Restore Modal Design */
        html[data-theme="modal"] {
            /* Global Modal Theme Variables */
            --modal-bg-primary: #2c3e50;
            --modal-bg-secondary: #34495e;
            --modal-accent: #f39c12;
            --modal-accent-hover: #e67e22;
            --modal-text-primary: #ecf0f1;
            --modal-text-secondary: #bdc3c7;
            --modal-border: #4a5f7a;
            --modal-success: #27ae60;
            --modal-warning: #f39c12;
            --modal-danger: #e74c3c;
        }
        
        /* MODAL THEME - OVERRIDE ALL GOLD/YELLOW COLORS */
        html[data-theme="modal"] .navbar-dark.bg-primary,
        html[data-theme="modal"] .bg-primary {
            background: linear-gradient(135deg, var(--modal-bg-secondary), var(--modal-bg-primary)) !important;
        }
        
        html[data-theme="modal"] .navbar-brand {
            color: var(--modal-accent) !important;
            font-weight: bold !important;
        }
        
        html[data-theme="modal"] .navbar-nav .nav-link {
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .navbar-nav .nav-link:hover {
            color: var(--modal-accent) !important;
        }
        
        html[data-theme="modal"] .navbar-nav .nav-link.active {
            color: var(--modal-accent) !important;
        }
        
        /* MODAL THEME - GLOBAL STYLES */
        html[data-theme="modal"] body {
            background: var(--modal-bg-primary) !important;
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .container,
        html[data-theme="modal"] .container-fluid {
            background: transparent !important;
        }
        
        /* MODAL THEME - CARDS AND PANELS */
        html[data-theme="modal"] .card {
            background: var(--modal-bg-secondary) !important;
            border: 1px solid var(--modal-border) !important;
            border-radius: 12px !important;
            color: var(--modal-text-primary) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
        }
        
        html[data-theme="modal"] .card-header {
            background: linear-gradient(135deg, var(--modal-accent), var(--modal-accent-hover)) !important;
            color: white !important;
            border-bottom: none !important;
            border-radius: 12px 12px 0 0 !important;
        }
        
        html[data-theme="modal"] .card-body {
            background: var(--modal-bg-secondary) !important;
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .card-footer {
            background: var(--modal-bg-primary) !important;
            border-top: 1px solid var(--modal-border) !important;
            border-radius: 0 0 12px 12px !important;
        }
        
        /* MODAL THEME - BUTTONS */
        html[data-theme="modal"] .btn-primary {
            background: linear-gradient(135deg, var(--modal-accent), var(--modal-accent-hover)) !important;
            border: none !important;
            color: white !important;
        }
        
        html[data-theme="modal"] .btn-primary:hover {
            background: linear-gradient(135deg, var(--modal-accent-hover), #d35400) !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4) !important;
        }
        
        html[data-theme="modal"] .btn-success {
            background: linear-gradient(135deg, var(--modal-success), #2ecc71) !important;
            border: none !important;
            color: white !important;
        }
        
        html[data-theme="modal"] .btn-success:hover {
            background: linear-gradient(135deg, #229954, var(--modal-success)) !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.4) !important;
        }
        
        html[data-theme="modal"] .btn-outline-primary {
            border-color: var(--modal-accent) !important;
            color: var(--modal-accent) !important;
            background: transparent !important;
        }
        
        html[data-theme="modal"] .btn-outline-primary:hover {
            background: var(--modal-accent) !important;
            border-color: var(--modal-accent) !important;
            color: white !important;
        }
        
        html[data-theme="modal"] .btn-secondary {
            background: #7f8c8d !important;
            border-color: #7f8c8d !important;
            color: white !important;
        }
        
        html[data-theme="modal"] .btn-secondary:hover {
            background: #6c7b7d !important;
            border-color: #6c7b7d !important;
        }
        
        /* MODAL THEME - FORMS */
        html[data-theme="modal"] .form-control {
            background: var(--modal-bg-primary) !important;
            border: 1px solid var(--modal-border) !important;
            color: var(--modal-text-primary) !important;
            border-radius: 8px !important;
        }
        
        html[data-theme="modal"] .form-control:focus {
            background: var(--modal-bg-primary) !important;
            border-color: var(--modal-accent) !important;
            box-shadow: 0 0 0 0.2rem rgba(243, 156, 18, 0.25) !important;
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .form-select {
            background: var(--modal-bg-primary) !important;
            border: 1px solid var(--modal-border) !important;
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .form-label {
            color: var(--modal-text-primary) !important;
            font-weight: 600 !important;
        }
        
        /* MODAL THEME - TABLES */
        html[data-theme="modal"] .table {
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .table-dark {
            background: var(--modal-bg-secondary) !important;
            border-color: var(--modal-border) !important;
        }
        
        html[data-theme="modal"] .table-dark th,
        html[data-theme="modal"] .table-dark td {
            border-color: var(--modal-border) !important;
        }
        
        html[data-theme="modal"] .table-striped > tbody > tr:nth-of-type(odd) > td {
            background: rgba(52, 73, 94, 0.5) !important;
        }
        
        /* MODAL THEME - NAVIGATION TABS */
        html[data-theme="modal"] .nav-tabs .nav-link {
            background: transparent !important;
            border: none !important;
            border-bottom: 3px solid transparent !important;
            color: var(--modal-text-secondary) !important;
            padding: 12px 20px !important;
            transition: all 0.3s ease !important;
        }
        
        html[data-theme="modal"] .nav-tabs .nav-link:hover {
            color: var(--modal-text-primary) !important;
            border-bottom-color: var(--modal-accent) !important;
        }
        
        html[data-theme="modal"] .nav-tabs .nav-link.active {
            color: var(--modal-accent) !important;
            border-bottom-color: var(--modal-accent) !important;
            background: rgba(243, 156, 18, 0.1) !important;
        }
        
        /* MODAL THEME - BADGES */
        html[data-theme="modal"] .badge {
            background: var(--modal-border) !important;
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .badge.bg-primary {
            background: var(--modal-accent) !important;
        }
        
        html[data-theme="modal"] .badge.bg-success {
            background: var(--modal-success) !important;
        }
        
        html[data-theme="modal"] .badge.bg-warning {
            background: var(--modal-warning) !important;
        }
        
        html[data-theme="modal"] .badge.bg-danger {
            background: var(--modal-danger) !important;
        }
        
        /* MODAL THEME - ALERTS */
        html[data-theme="modal"] .alert {
            border-radius: 8px !important;
            border: none !important;
        }
        
        html[data-theme="modal"] .alert-info {
            background: rgba(52, 152, 219, 0.2) !important;
            color: #3498db !important;
            border-left: 4px solid #3498db !important;
        }
        
        html[data-theme="modal"] .alert-success {
            background: rgba(39, 174, 96, 0.2) !important;
            color: var(--modal-success) !important;
            border-left: 4px solid var(--modal-success) !important;
        }
        
        html[data-theme="modal"] .alert-warning {
            background: rgba(243, 156, 18, 0.2) !important;
            color: var(--modal-warning) !important;
            border-left: 4px solid var(--modal-warning) !important;
        }
        
        html[data-theme="modal"] .alert-danger {
            background: rgba(231, 76, 60, 0.2) !important;
            color: var(--modal-danger) !important;
            border-left: 4px solid var(--modal-danger) !important;
        }
        
        /* MODAL THEME - MODALS */
        html[data-theme="modal"] .modal-content {
            background: var(--modal-bg-primary) !important;
            border: 1px solid var(--modal-border) !important;
            border-radius: 12px !important;
            color: var(--modal-text-primary) !important;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5) !important;
        }
        
        html[data-theme="modal"] .modal-header {
            background: linear-gradient(135deg, var(--modal-accent), var(--modal-accent-hover)) !important;
            color: white !important;
            border-radius: 12px 12px 0 0 !important;
            border-bottom: none !important;
        }
        
        html[data-theme="modal"] .modal-body {
            background: var(--modal-bg-primary) !important;
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .modal-footer {
            background: var(--modal-bg-secondary) !important;
            border-top: 1px solid var(--modal-border) !important;
            border-radius: 0 0 12px 12px !important;
        }
        
        /* MODAL THEME - DROPDOWN MENUS */
        html[data-theme="modal"] .dropdown-menu {
            background: var(--modal-bg-secondary) !important;
            border: 1px solid var(--modal-border) !important;
            border-radius: 8px !important;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3) !important;
        }
        
        html[data-theme="modal"] .dropdown-item {
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .dropdown-item:hover {
            background: var(--modal-accent) !important;
            color: white !important;
        }
        
        html[data-theme="modal"] .dropdown-divider {
            border-color: var(--modal-border) !important;
        }
        
        /* MODAL THEME - TEXT COLORS */
        html[data-theme="modal"] .text-muted {
            color: var(--modal-text-secondary) !important;
        }
        
        html[data-theme="modal"] .text-primary {
            color: var(--modal-accent) !important;
        }
        
        html[data-theme="modal"] .text-success {
            color: var(--modal-success) !important;
        }
        
        html[data-theme="modal"] .text-warning {
            color: var(--modal-warning) !important;
        }
        
        html[data-theme="modal"] .text-danger {
            color: var(--modal-danger) !important;
        }
        
        /* MODAL THEME - BORDERS */
        html[data-theme="modal"] .border {
            border-color: var(--modal-border) !important;
        }
        
        html[data-theme="modal"] .border-primary {
            border-color: var(--modal-accent) !important;
        }
        
        html[data-theme="modal"] .border-success {
            border-color: var(--modal-success) !important;
        }
        
        /* MODAL THEME - PAGINATION */
        html[data-theme="modal"] .pagination .page-link {
            background: var(--modal-bg-secondary) !important;
            border-color: var(--modal-border) !important;
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .pagination .page-link:hover {
            background: var(--modal-accent) !important;
            border-color: var(--modal-accent) !important;
            color: white !important;
        }
        
        html[data-theme="modal"] .pagination .page-item.active .page-link {
            background: var(--modal-accent) !important;
            border-color: var(--modal-accent) !important;
        }
        
        /* MODAL THEME - COMPREHENSIVE OVERRIDES FOR ALL GOLD/YELLOW ELEMENTS */
        
        /* Override any remaining gold/yellow backgrounds */
        html[data-theme="modal"] .bg-warning,
        html[data-theme="modal"] .bg-gold,
        html[data-theme="modal"] .bg-yellow,
        html[data-theme="modal"] .alert-warning {
            background: var(--modal-accent) !important;
            color: white !important;
        }
        
        /* Override gold/yellow text colors */
        html[data-theme="modal"] .text-warning,
        html[data-theme="modal"] .text-gold,
        html[data-theme="modal"] .text-yellow {
            color: var(--modal-accent) !important;
        }
        
        /* Override gold/yellow borders */
        html[data-theme="modal"] .border-warning,
        html[data-theme="modal"] .border-gold,
        html[data-theme="modal"] .border-yellow {
            border-color: var(--modal-accent) !important;
        }
        
        /* Override any card headers with gold/yellow */
        html[data-theme="modal"] .card-header.bg-warning,
        html[data-theme="modal"] .card-header.bg-gold,
        html[data-theme="modal"] .card-header.bg-yellow {
            background: linear-gradient(135deg, var(--modal-accent), var(--modal-accent-hover)) !important;
            color: white !important;
        }
        
        /* Override buttons with gold/yellow */
        html[data-theme="modal"] .btn-warning,
        html[data-theme="modal"] .btn-gold,
        html[data-theme="modal"] .btn-yellow {
            background: linear-gradient(135deg, var(--modal-accent), var(--modal-accent-hover)) !important;
            border-color: var(--modal-accent) !important;
            color: white !important;
        }
        
        html[data-theme="modal"] .btn-warning:hover,
        html[data-theme="modal"] .btn-gold:hover,
        html[data-theme="modal"] .btn-yellow:hover {
            background: linear-gradient(135deg, var(--modal-accent-hover), #d35400) !important;
            border-color: var(--modal-accent-hover) !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(243, 156, 18, 0.4) !important;
        }
        
        /* Override outline buttons */
        html[data-theme="modal"] .btn-outline-warning,
        html[data-theme="modal"] .btn-outline-gold,
        html[data-theme="modal"] .btn-outline-yellow {
            border-color: var(--modal-accent) !important;
            color: var(--modal-accent) !important;
            background: transparent !important;
        }
        
        html[data-theme="modal"] .btn-outline-warning:hover,
        html[data-theme="modal"] .btn-outline-gold:hover,
        html[data-theme="modal"] .btn-outline-yellow:hover {
            background: var(--modal-accent) !important;
            border-color: var(--modal-accent) !important;
            color: white !important;
        }
        
        /* Override any remaining navbar gold styles */
        html[data-theme="modal"] .navbar {
            background: linear-gradient(135deg, var(--modal-bg-secondary), var(--modal-bg-primary)) !important;
        }
        
        html[data-theme="modal"] .navbar .navbar-toggler {
            border-color: var(--modal-accent) !important;
        }
        
        html[data-theme="modal"] .navbar .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28243, 156, 18, 1%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='m4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
        }
        
        /* Override dropdown menu items */
        html[data-theme="modal"] .dropdown-item.active,
        html[data-theme="modal"] .dropdown-item:active {
            background: var(--modal-accent) !important;
            color: white !important;
        }
        
        /* Override any list group items */
        html[data-theme="modal"] .list-group-item {
            background: var(--modal-bg-secondary) !important;
            border-color: var(--modal-border) !important;
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .list-group-item.active {
            background: var(--modal-accent) !important;
            border-color: var(--modal-accent) !important;
            color: white !important;
        }
        
        /* Override any progress bars */
        html[data-theme="modal"] .progress {
            background: var(--modal-bg-primary) !important;
        }
        
        html[data-theme="modal"] .progress-bar {
            background: var(--modal-accent) !important;
        }
        
        /* Override any spinners or loading elements */
        html[data-theme="modal"] .spinner-border {
            color: var(--modal-accent) !important;
        }
        
        /* Override any toast notifications */
        html[data-theme="modal"] .toast {
            background: var(--modal-bg-secondary) !important;
            border: 1px solid var(--modal-border) !important;
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .toast-header {
            background: var(--modal-bg-primary) !important;
            border-bottom: 1px solid var(--modal-border) !important;
            color: var(--modal-text-primary) !important;
        }
        
        /* Override any accordion elements */
        html[data-theme="modal"] .accordion-item {
            background: var(--modal-bg-secondary) !important;
            border: 1px solid var(--modal-border) !important;
        }
        
        html[data-theme="modal"] .accordion-header .accordion-button {
            background: var(--modal-bg-primary) !important;
            color: var(--modal-text-primary) !important;
            border: none !important;
        }
        
        html[data-theme="modal"] .accordion-header .accordion-button:not(.collapsed) {
            background: var(--modal-accent) !important;
            color: white !important;
        }
        
        html[data-theme="modal"] .accordion-body {
            background: var(--modal-bg-secondary) !important;
            color: var(--modal-text-primary) !important;
        }
        
        /* Override any offcanvas elements */
        html[data-theme="modal"] .offcanvas {
            background: var(--modal-bg-primary) !important;
            color: var(--modal-text-primary) !important;
        }
        
        html[data-theme="modal"] .offcanvas-header {
            background: var(--modal-accent) !important;
            color: white !important;
        }
        
        /* Override any carousel elements */
        html[data-theme="modal"] .carousel-control-prev,
        html[data-theme="modal"] .carousel-control-next {
            color: var(--modal-accent) !important;
        }
        
        html[data-theme="modal"] .carousel-indicators [data-bs-target] {
            background-color: var(--modal-accent) !important;
        }
        
        /* Override any custom gold/yellow classes that might exist */
        html[data-theme="modal"] .gold-theme,
        html[data-theme="modal"] .yellow-theme,
        html[data-theme="modal"] .warning-theme {
            background: var(--modal-accent) !important;
            color: white !important;
        }
        
        /* Override any inline styles with gold/yellow (using high specificity) */
        html[data-theme="modal"] [style*="background-color: #f39c12"],
        html[data-theme="modal"] [style*="background-color: #e67e22"],
        html[data-theme="modal"] [style*="background-color: gold"],
        html[data-theme="modal"] [style*="background-color: yellow"],
        html[data-theme="modal"] [style*="background: #f39c12"],
        html[data-theme="modal"] [style*="background: #e67e22"],
        html[data-theme="modal"] [style*="background: gold"],
        html[data-theme="modal"] [style*="background: yellow"] {
            background: var(--modal-accent) !important;
            color: white !important;
        }
        
        /* Override any text with gold/yellow inline styles */
        html[data-theme="modal"] [style*="color: #f39c12"],
        html[data-theme="modal"] [style*="color: #e67e22"],
        html[data-theme="modal"] [style*="color: gold"],
        html[data-theme="modal"] [style*="color: yellow"] {
            color: var(--modal-accent) !important;
        }
        
        /* MODAL THEME - SPECIFIC ADMIN DASHBOARD CARDS BY POSITION */
        
        /* Target each stats card individually by position for unique colors */
        
        /* First Row Cards - Main Stats */
        html[data-theme="modal"] .row.mb-4:nth-of-type(3) .col-md-3:nth-child(1) .card {
            background: linear-gradient(135deg, #3498db, #2980b9) !important; /* Blue - Total Orders */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(3) .col-md-3:nth-child(2) .card {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important; /* Red - Today's Orders */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(3) .col-md-3:nth-child(3) .card {
            background: linear-gradient(135deg, #27ae60, #229954) !important; /* Green - Total Revenue */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(3) .col-md-3:nth-child(4) .card {
            background: linear-gradient(135deg, #9b59b6, #8e44ad) !important; /* Purple - Today's Sales */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3) !important;
        }
        
        /* Second Row Cards - Cash and Card */
        html[data-theme="modal"] .row.mb-4:nth-of-type(4) .col-md-3:nth-child(1) .card {
            background: linear-gradient(135deg, #f39c12, #e67e22) !important; /* Orange - Total Cash */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(4) .col-md-3:nth-child(2) .card {
            background: linear-gradient(135deg, #1abc9c, #16a085) !important; /* Teal - Total Card */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(26, 188, 156, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(4) .col-md-3:nth-child(3) .card {
            background: linear-gradient(135deg, #e67e22, #d35400) !important; /* Dark Orange - Today's Cash */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(230, 126, 34, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(4) .col-md-3:nth-child(4) .card {
            background: linear-gradient(135deg, #34495e, #2c3e50) !important; /* Dark Blue - Today's Card */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(52, 73, 94, 0.3) !important;
        }
        
        /* Third Row Cards - Edited Orders */
        html[data-theme="modal"] .row.mb-4:nth-of-type(5) .col-md-6:nth-child(1) .card {
            background: linear-gradient(135deg, #f1c40f, #f39c12) !important; /* Yellow - Orders Edited Today */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(241, 196, 15, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(5) .col-md-6:nth-child(2) .card {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d) !important; /* Gray - Total Edited Orders */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3) !important;
        }
        
        /* Ensure text remains white and readable on all colored cards */
        html[data-theme="modal"] .row.mb-4 .card.text-white,
        html[data-theme="modal"] .row.mb-4 .card.text-white h2,
        html[data-theme="modal"] .row.mb-4 .card.text-white h5,
        html[data-theme="modal"] .row.mb-4 .card.text-white .card-title {
            color: white !important;
        }
        
        /* Override small text colors for better readability */
        html[data-theme="modal"] .row.mb-4 .card.text-white small.text-dark,
        html[data-theme="modal"] .row.mb-4 .card.text-white small.text-muted {
            color: rgba(255, 255, 255, 0.8) !important;
        }
        
        html[data-theme="modal"] .row.mb-4 .card.text-white small.text-light {
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        /* MODAL THEME - DIRECT BOOTSTRAP CLASS OVERRIDES FOR ADMIN DASHBOARD */
        
        /* Target the first row of stats cards directly by Bootstrap classes */
        html[data-theme="modal"] .card.text-white.bg-primary {
            background: linear-gradient(135deg, #3498db, #2980b9) !important; /* Blue - Total Orders */
            border: none !important;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3) !important;
        }
        
        html[data-theme="modal"] .card.text-white.bg-warning {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important; /* Red - Today's Orders */
            border: none !important;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3) !important;
        }
        
        html[data-theme="modal"] .card.text-white.bg-success {
            background: linear-gradient(135deg, #27ae60, #229954) !important; /* Green - Total Revenue */
            border: none !important;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3) !important;
        }
        
        html[data-theme="modal"] .card.text-white.bg-info {
            background: linear-gradient(135deg, #9b59b6, #8e44ad) !important; /* Purple - Today's Sales */
            border: none !important;
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3) !important;
        }
        
        /* More specific targeting for the exact cards by content */
        html[data-theme="modal"] .card-title:contains("Total Orders") {
            background: linear-gradient(135deg, #3498db, #2980b9) !important;
        }
        
        /* Alternative approach - target by card position in the first stats row */
        html[data-theme="modal"] .row.mb-4:first-of-type .col-md-3:nth-child(1) .card {
            background: linear-gradient(135deg, #3498db, #2980b9) !important; /* Blue - Total Orders */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:first-of-type .col-md-3:nth-child(2) .card {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important; /* Red - Today's Orders */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:first-of-type .col-md-3:nth-child(3) .card {
            background: linear-gradient(135deg, #27ae60, #229954) !important; /* Green - Total Revenue */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:first-of-type .col-md-3:nth-child(4) .card {
            background: linear-gradient(135deg, #9b59b6, #8e44ad) !important; /* Purple - Today's Sales */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3) !important;
        }
        
        /* Ultra-specific override with maximum CSS specificity */
        html[data-theme="modal"] div.row.mb-4 div.col-md-3 div.card.text-white.bg-primary {
            background: linear-gradient(135deg, #3498db, #2980b9) !important;
        }
        
        html[data-theme="modal"] div.row.mb-4 div.col-md-3 div.card.text-white.bg-warning {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
        }
        
        html[data-theme="modal"] div.row.mb-4 div.col-md-3 div.card.text-white.bg-success {
            background: linear-gradient(135deg, #27ae60, #229954) !important;
        }
        
        html[data-theme="modal"] div.row.mb-4 div.col-md-3 div.card.text-white.bg-info {
            background: linear-gradient(135deg, #9b59b6, #8e44ad) !important;
        }
        
        /* MODAL THEME - ALL 10 ADMIN DASHBOARD CARDS WITH UNIQUE COLORS */
        
        /* ROW 1 - Main Statistics (4 cards) */
        html[data-theme="modal"] .row.mb-4:nth-of-type(1) .col-md-3:nth-child(1) .card,
        html[data-theme="modal"] .row.mb-4:nth-of-type(1) .col-md-3:nth-child(1) .card.bg-primary {
            background: linear-gradient(135deg, #3498db, #2980b9) !important; /* Blue - Total Orders */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(1) .col-md-3:nth-child(2) .card,
        html[data-theme="modal"] .row.mb-4:nth-of-type(1) .col-md-3:nth-child(2) .card.bg-warning {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important; /* Red - Today's Orders */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(1) .col-md-3:nth-child(3) .card,
        html[data-theme="modal"] .row.mb-4:nth-of-type(1) .col-md-3:nth-child(3) .card.bg-success {
            background: linear-gradient(135deg, #27ae60, #229954) !important; /* Green - Total Revenue */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(1) .col-md-3:nth-child(4) .card,
        html[data-theme="modal"] .row.mb-4:nth-of-type(1) .col-md-3:nth-child(4) .card.bg-info {
            background: linear-gradient(135deg, #e91e63, #ad1457) !important; /* Pink/Magenta - Today's Sales */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3) !important;
        }
        
        /* ROW 2 - Cash and Card Statistics (4 cards) */
        html[data-theme="modal"] .row.mb-4:nth-of-type(2) .col-md-3:nth-child(1) .card,
        html[data-theme="modal"] .row.mb-4:nth-of-type(2) .col-md-3:nth-child(1) .card.bg-primary {
            background: linear-gradient(135deg, #f39c12, #e67e22) !important; /* Orange - Total Cash */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(2) .col-md-3:nth-child(2) .card,
        html[data-theme="modal"] .row.mb-4:nth-of-type(2) .col-md-3:nth-child(2) .card.bg-success {
            background: linear-gradient(135deg, #1abc9c, #16a085) !important; /* Teal - Total Card */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(26, 188, 156, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(2) .col-md-3:nth-child(3) .card,
        html[data-theme="modal"] .row.mb-4:nth-of-type(2) .col-md-3:nth-child(3) .card.bg-warning {
            background: linear-gradient(135deg, #e67e22, #d35400) !important; /* Dark Orange - Today's Cash */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(230, 126, 34, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(2) .col-md-3:nth-child(4) .card,
        html[data-theme="modal"] .row.mb-4:nth-of-type(2) .col-md-3:nth-child(4) .card.bg-info {
            background: linear-gradient(135deg, #34495e, #2c3e50) !important; /* Dark Blue - Today's Card */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(52, 73, 94, 0.3) !important;
        }
        
        /* ROW 3 - Edited Orders Statistics (2 cards) */
        html[data-theme="modal"] .row.mb-4:nth-of-type(3) .col-md-6:nth-child(1) .card,
        html[data-theme="modal"] .row.mb-4:nth-of-type(3) .col-md-6:nth-child(1) .card.bg-warning {
            background: linear-gradient(135deg, #f1c40f, #f39c12) !important; /* Yellow - Orders Edited Today */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(241, 196, 15, 0.3) !important;
        }
        
        html[data-theme="modal"] .row.mb-4:nth-of-type(3) .col-md-6:nth-child(2) .card,
        html[data-theme="modal"] .row.mb-4:nth-of-type(3) .col-md-6:nth-child(2) .card.bg-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d) !important; /* Gray - Total Edited Orders */
            color: white !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(149, 165, 166, 0.3) !important;
        }
        
        /* ADDITIONAL FALLBACK - Target by card title content for extra reliability */
        html[data-theme="modal"] .card-title:contains("Total Orders") ~ * {
            background: linear-gradient(135deg, #3498db, #2980b9) !important;
        }
        
        html[data-theme="modal"] .card-title:contains("Today's Orders") ~ * {
            background: linear-gradient(135deg, #e74c3c, #c0392b) !important;
        }
        
        html[data-theme="modal"] .card-title:contains("Total Revenue") ~ * {
            background: linear-gradient(135deg, #27ae60, #229954) !important;
        }
        
        html[data-theme="modal"] .card-title:contains("Today's Sales") ~ * {
            background: linear-gradient(135deg, #e91e63, #ad1457) !important;
        }
        
        html[data-theme="modal"] .card-title:contains("Total Cash") ~ * {
            background: linear-gradient(135deg, #f39c12, #e67e22) !important;
        }
        
        html[data-theme="modal"] .card-title:contains("Total Card") ~ * {
            background: linear-gradient(135deg, #1abc9c, #16a085) !important;
        }
        
        html[data-theme="modal"] .card-title:contains("Today's Cash") ~ * {
            background: linear-gradient(135deg, #e67e22, #d35400) !important;
        }
        
        html[data-theme="modal"] .card-title:contains("Today's Card") ~ * {
            background: linear-gradient(135deg, #34495e, #2c3e50) !important;
        }
        
        html[data-theme="modal"] .card-title:contains("Orders Edited Today") ~ * {
            background: linear-gradient(135deg, #f1c40f, #f39c12) !important;
        }
        
        html[data-theme="modal"] .card-title:contains("Total Edited Orders") ~ * {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d) !important;
        }
        
        /* MODAL THEME - PROMINENT/RAISED CARD ICONS (نافرة) */
        
        /* Make all card icons more prominent and raised */
        html[data-theme="modal"] .card .bi,
        html[data-theme="modal"] .card i[class*="bi-"],
        html[data-theme="modal"] .card i.bi {
            text-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(255, 255, 255, 0.1) !important;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)) !important;
            transform: translateZ(0) !important;
            position: relative !important;
            z-index: 2 !important;
            opacity: 0.9 !important;
            transition: all 0.3s ease !important;
        }
        
        /* Enhanced prominence on hover */
        html[data-theme="modal"] .card:hover .bi,
        html[data-theme="modal"] .card:hover i[class*="bi-"],
        html[data-theme="modal"] .card:hover i.bi {
            text-shadow: 
                0 3px 6px rgba(0, 0, 0, 0.4),
                0 6px 12px rgba(0, 0, 0, 0.3),
                0 0 0 2px rgba(255, 255, 255, 0.2) !important;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4)) !important;
            transform: translateZ(0) scale(1.05) !important;
            opacity: 1 !important;
        }
        
        /* Specific styling for large icons (3rem size) */
        html[data-theme="modal"] .card i[style*="font-size: 3rem"],
        html[data-theme="modal"] .card .bi[style*="font-size: 3rem"] {
            text-shadow: 
                0 3px 6px rgba(0, 0, 0, 0.4),
                0 6px 12px rgba(0, 0, 0, 0.3),
                0 0 0 2px rgba(255, 255, 255, 0.15) !important;
            filter: 
                drop-shadow(0 3px 6px rgba(0, 0, 0, 0.4))
                drop-shadow(0 1px 2px rgba(255, 255, 255, 0.1)) !important;
            font-weight: 600 !important;
            position: relative !important;
            z-index: 3 !important;
        }
        
        /* Add subtle glow effect for extra prominence */
        html[data-theme="modal"] .card .fa-2x,
        html[data-theme="modal"] .card i[style*="font-size: 3rem"] {
            filter: 
                drop-shadow(0 3px 6px rgba(0, 0, 0, 0.4))
                drop-shadow(0 0 8px rgba(255, 255, 255, 0.1))
                drop-shadow(0 1px 2px rgba(255, 255, 255, 0.2)) !important;
        }
        
        /* Enhanced 3D effect for card icons */
        html[data-theme="modal"] .card-body .bi,
        html[data-theme="modal"] .card-body i {
            background: linear-gradient(135deg, 
                rgba(255, 255, 255, 0.1) 0%, 
                rgba(255, 255, 255, 0.05) 50%, 
                rgba(0, 0, 0, 0.1) 100%) !important;
            -webkit-background-clip: text !important;
            background-clip: text !important;
            text-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.3),
                0 4px 8px rgba(0, 0, 0, 0.2),
                1px 1px 0 rgba(255, 255, 255, 0.1),
                -1px -1px 0 rgba(0, 0, 0, 0.1) !important;
        }
        
        /* MODAL THEME - GLASSMORPHISM UI (OPTIMIZED FOR LOW-END PCs) */
        
        /* Global glassmorphism variables */
        html[data-theme="modal"] {
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --glass-backdrop: blur(10px);
            --glass-hover-bg: rgba(255, 255, 255, 0.15);
            --glass-active-bg: rgba(255, 255, 255, 0.2);
        }
        
        /* Main container glassmorphism - EXCLUDE NAVBAR CONTAINERS */
        html[data-theme="modal"] .container:not(.navbar .container):not(.navbar .container-fluid),
        html[data-theme="modal"] .container-fluid:not(.navbar .container-fluid):not(.navbar .container) {
            background: rgba(44, 62, 80, 0.8) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border-radius: 20px !important;
            border: 1px solid var(--glass-border) !important;
            box-shadow: var(--glass-shadow) !important;
            margin-top: 10px !important;
            margin-bottom: 10px !important;
            padding: 20px !important;
        }
        
        /* Ensure navbar containers have NO glassmorphism */
        html[data-theme="modal"] .navbar .container,
        html[data-theme="modal"] .navbar .container-fluid {
            background: none !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            border-radius: 0 !important;
            border: none !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* Card glassmorphism */
        html[data-theme="modal"] .card {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 16px !important;
            box-shadow: var(--glass-shadow) !important;
            transition: all 0.3s ease !important;
        }
        
        html[data-theme="modal"] .card:hover {
            background: var(--glass-hover-bg) !important;
            transform: translateY(-5px) !important;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4) !important;
        }
        
        /* Card headers with enhanced glass effect */
        html[data-theme="modal"] .card-header {
            background: linear-gradient(135deg, 
                rgba(243, 156, 18, 0.8), 
                rgba(230, 126, 34, 0.8)) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: none !important;
            border-bottom: 1px solid var(--glass-border) !important;
            border-radius: 16px 16px 0 0 !important;
            color: white !important;
        }
        
        /* Form controls with glass effect */
        html[data-theme="modal"] .form-control,
        html[data-theme="modal"] .form-select {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 12px !important;
            color: var(--modal-text-primary) !important;
            transition: all 0.3s ease !important;
        }
        
        html[data-theme="modal"] .form-control:focus,
        html[data-theme="modal"] .form-select:focus {
            background: var(--glass-hover-bg) !important;
            border-color: var(--modal-accent) !important;
            box-shadow: 0 0 0 0.2rem rgba(243, 156, 18, 0.25), 
                        0 4px 12px rgba(0, 0, 0, 0.2) !important;
        }
        
        /* Button glassmorphism */
        html[data-theme="modal"] .btn {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 12px !important;
            transition: all 0.3s ease !important;
            font-weight: 600 !important;
        }
        
        html[data-theme="modal"] .btn:hover {
            background: var(--glass-hover-bg) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
        }
        
        html[data-theme="modal"] .btn:active {
            background: var(--glass-active-bg) !important;
            transform: translateY(0) !important;
        }
        
        /* Primary button enhanced glass */
        html[data-theme="modal"] .btn-primary {
            background: linear-gradient(135deg, 
                rgba(243, 156, 18, 0.8), 
                rgba(230, 126, 34, 0.8)) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid rgba(243, 156, 18, 0.5) !important;
            color: white !important;
        }
        
        html[data-theme="modal"] .btn-primary:hover {
            background: linear-gradient(135deg, 
                rgba(243, 156, 18, 0.9), 
                rgba(230, 126, 34, 0.9)) !important;
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.4) !important;
        }
        
        
        /* Dropdown glassmorphism */
        html[data-theme="modal"] .dropdown-menu {
            background: rgba(52, 73, 94, 0.9) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 12px !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
        }
        
        html[data-theme="modal"] .dropdown-item {
            background: transparent !important;
            transition: all 0.3s ease !important;
        }
        
        html[data-theme="modal"] .dropdown-item:hover {
            background: var(--glass-hover-bg) !important;
            border-radius: 8px !important;
        }
        
        /* Modal glassmorphism */
        html[data-theme="modal"] .modal-content {
            background: rgba(44, 62, 80, 0.9) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 20px !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5) !important;
        }
        
        html[data-theme="modal"] .modal-header {
            background: linear-gradient(135deg, 
                rgba(243, 156, 18, 0.8), 
                rgba(230, 126, 34, 0.8)) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border-radius: 20px 20px 0 0 !important;
            border-bottom: 1px solid var(--glass-border) !important;
        }
        
        /* Fix modal backdrop - ensure it stays BEHIND modal content */
        html[data-theme="modal"] .modal-backdrop {
            background: rgba(0, 0, 0, 0.5) !important;
            backdrop-filter: none !important;
            -webkit-backdrop-filter: none !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            pointer-events: none !important;
            z-index: 1040 !important;
            position: fixed !important;
        }
        
        /* Ensure modal container is above backdrop */
        html[data-theme="modal"] .modal {
            z-index: 1055 !important;
            position: fixed !important;
        }
        
        /* Ensure modal dialog is above backdrop */
        html[data-theme="modal"] .modal-dialog {
            z-index: 1060 !important;
            position: relative !important;
        }
        
        /* Ensure modal content is above everything */
        html[data-theme="modal"] .modal-content {
            z-index: 1065 !important;
            position: relative !important;
        }
        
        /* Make sure modal body and footer are clickable */
        html[data-theme="modal"] .modal-body,
        html[data-theme="modal"] .modal-footer,
        html[data-theme="modal"] .modal-header {
            z-index: 1070 !important;
            position: relative !important;
            pointer-events: auto !important;
        }
        
        /* Ensure all buttons and inputs in modals are clickable */
        html[data-theme="modal"] .modal .btn,
        html[data-theme="modal"] .modal .form-control,
        html[data-theme="modal"] .modal .form-select,
        html[data-theme="modal"] .modal input,
        html[data-theme="modal"] .modal button,
        html[data-theme="modal"] .modal a {
            z-index: 1075 !important;
            position: relative !important;
            pointer-events: auto !important;
        }
        
        /* Table glassmorphism */
        html[data-theme="modal"] .table {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border-radius: 12px !important;
            overflow: hidden !important;
        }
        
        html[data-theme="modal"] .table th,
        html[data-theme="modal"] .table td {
            background: rgba(255, 255, 255, 0.05) !important;
            border-color: var(--glass-border) !important;
        }
        
        html[data-theme="modal"] .table-striped > tbody > tr:nth-of-type(odd) > td {
            background: rgba(255, 255, 255, 0.08) !important;
        }
        
        /* Alert glassmorphism */
        html[data-theme="modal"] .alert {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 12px !important;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2) !important;
        }
        
        /* Badge glassmorphism */
        html[data-theme="modal"] .badge {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 8px !important;
        }
        
        /* Toast glassmorphism */
        html[data-theme="modal"] .toast {
            background: rgba(52, 73, 94, 0.9) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 12px !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
        }
        
        /* Pagination glassmorphism */
        html[data-theme="modal"] .pagination .page-link {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 8px !important;
            margin: 0 2px !important;
            transition: all 0.3s ease !important;
        }
        
        html[data-theme="modal"] .pagination .page-link:hover {
            background: var(--glass-hover-bg) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
        }
        
        /* Accordion glassmorphism */
        html[data-theme="modal"] .accordion-item {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 12px !important;
            margin-bottom: 8px !important;
        }
        
        /* Progress bar glassmorphism */
        html[data-theme="modal"] .progress {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border-radius: 10px !important;
            border: 1px solid var(--glass-border) !important;
        }
        
        /* List group glassmorphism */
        html[data-theme="modal"] .list-group-item {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 8px !important;
            margin-bottom: 4px !important;
            transition: all 0.3s ease !important;
        }
        
        html[data-theme="modal"] .list-group-item:hover {
            background: var(--glass-hover-bg) !important;
            transform: translateX(5px) !important;
        }
        
        /* Offcanvas glassmorphism */
        html[data-theme="modal"] .offcanvas {
            background: rgba(44, 62, 80, 0.9) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
        }
        
        /* Tab glassmorphism */
        html[data-theme="modal"] .nav-tabs .nav-link {
            background: var(--glass-bg) !important;
            backdrop-filter: var(--glass-backdrop) !important;
            -webkit-backdrop-filter: var(--glass-backdrop) !important;
            border: 1px solid var(--glass-border) !important;
            border-radius: 12px 12px 0 0 !important;
            margin-right: 4px !important;
            transition: all 0.3s ease !important;
        }
        
        html[data-theme="modal"] .nav-tabs .nav-link:hover {
            background: var(--glass-hover-bg) !important;
            transform: translateY(-2px) !important;
        }
        
        html[data-theme="modal"] .nav-tabs .nav-link.active {
            background: var(--glass-active-bg) !important;
            border-bottom-color: transparent !important;
        }
        
        /* PERFORMANCE OPTIMIZATIONS FOR LOW-END PCs */
        
        /* Reduce animations on low-end devices */
        @media (prefers-reduced-motion: reduce) {
            html[data-theme="modal"] * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
            }
        }
        
        /* Simplified glass for older browsers */
        @supports not (backdrop-filter: blur(10px)) {
            html[data-theme="modal"] .card,
            html[data-theme="modal"] .modal-content,
            html[data-theme="modal"] .dropdown-menu {
                background: rgba(52, 73, 94, 0.95) !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
            }
        }
        
        /* Mobile optimization */
        @media (max-width: 768px) {
            html[data-theme="modal"] {
                --glass-backdrop: blur(5px);
            }
            
            html[data-theme="modal"] .container,
            html[data-theme="modal"] .container-fluid {
                border-radius: 12px !important;
                margin: 5px !important;
                padding: 15px !important;
            }
            
            html[data-theme="modal"] .card {
                border-radius: 12px !important;
            }
        }
        
        /* Low-end PC optimization */
        @media (max-resolution: 1dppx) {
            html[data-theme="modal"] {
                --glass-backdrop: blur(5px);
                --glass-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            }
        }
    </style>
</head>
<body class="bg-dark text-light">
    {% block navbar %}
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary collapsible-navbar">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('main.index') }}">
                <i class="bi bi-shop"></i> Restaurant POS
            </a>
            
            {% if current_user.is_authenticated %}
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    {% if current_user.role.name in ['ADMIN', 'BRANCH_ADMIN'] %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.dashboard') }}">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.users') }}">
                                <i class="bi bi-people"></i> Users
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.menu') }}">
                                <i class="bi bi-list"></i> Menu
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.orders') }}">
                                <i class="bi bi-receipt"></i> Orders
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.kitchens') }}">
                                <i class="bi bi-house"></i> Kitchens
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.cashier_performance') }}">
                                <i class="bi bi-person-badge"></i> Cashier Performance
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.audit_logs') }}">
                                <i class="bi bi-journal-text"></i> Audit Logs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.reports') }}">
                                <i class="bi bi-graph-up"></i> Reports
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin.settings') }}">
                                <i class="bi bi-gear"></i> Settings
                            </a>
                        </li>
                    {% elif current_user.role.name == 'SUPER_USER' %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('superuser.dashboard') }}">
                                <i class="bi bi-shield-check"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('superuser.branches') }}">
                                <i class="bi bi-building"></i> Branches
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('superuser.users') }}">
                                <i class="bi bi-people"></i> All Users
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('superuser.orders') }}">
                                <i class="bi bi-receipt"></i> All Orders
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('superuser.cashier_performance') }}">
                                <i class="bi bi-person-badge"></i> Cashier Performance
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('superuser.audit_logs') }}">
                                <i class="bi bi-journal-text"></i> Audit Logs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('superuser.reports') }}">
                                <i class="bi bi-graph-up"></i> Reports
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('superuser.settings') }}">
                                <i class="bi bi-gear"></i> Settings
                            </a>
                        </li>
                    {% elif current_user.role.name == 'CASHIER' %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('pos.index') }}">
                                <i class="bi bi-calculator"></i> POS
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('pos.dashboard') }}">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('pos.waiter_requests') }}">
                                <i class="bi bi-person-badge"></i> Waiter Requests
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('cashier.settings') }}">
                                <i class="bi bi-gear"></i> Settings
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('pos.orders') }}">
                                <i class="bi bi-list"></i> My Orders
                            </a>
                        </li>
                    {% elif current_user.role.name == 'WAITER' %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('pos.table_management') }}">
                                <i class="bi bi-table"></i> Table Management
                            </a>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('pos.index') }}">
                                <i class="bi bi-calculator"></i> POS
                            </a>
                        </li>
                    {% endif %}
                </ul>
                
                <ul class="navbar-nav">
                    <!-- Theme Switcher -->
                    <li class="nav-item">
                        <button class="btn theme-switcher" onclick="toggleTheme()" id="themeToggle">
                            <i class="bi bi-palette"></i> 
                            <span id="themeText">{% if current_user.theme_preference == 'modal' %}Modal{% else %}Dark{% endif %}</span>
                        </button>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle"></i> {{ current_user.username }}
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-person"></i> Profile</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" id="logoutLink" onclick="checkDailyReportBeforeLogout(event)">
                                <i class="bi bi-box-arrow-right"></i> Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            {% endif %}
        </div>
    </nav>
    {% endblock %}

    <div class="container-fluid mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Socket.IO client for real-time features used on POS pages -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    
    <script>
    // Global Socket.IO initialization for all pages
    let socket;
    
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Socket.IO connection globally
        socket = io();
        
        // Global connection event handlers
        socket.on('connect', function() {
            console.log('Global Socket.IO connected');
            
            // Join appropriate rooms based on user role and branch
            {% if current_user.is_authenticated %}
                {% if current_user.branch_id %}
                socket.emit('join', {room: 'branch_{{ current_user.branch_id }}'});
                console.log('Joined branch room: branch_{{ current_user.branch_id }}');
                {% endif %}
                
                {% if current_user.role.name == 'CASHIER' %}
                socket.emit('join', {room: 'cashiers_branch_{{ current_user.branch_id }}'});
                console.log('Joined cashier room: cashiers_branch_{{ current_user.branch_id }}');
                {% endif %}
                
                {% if current_user.role.name == 'WAITER' %}
                socket.emit('join', {room: 'waiters_branch_{{ current_user.branch_id }}'});
                console.log('Joined waiter room: waiters_branch_{{ current_user.branch_id }}');
                {% endif %}
            {% endif %}
        });
        
        socket.on('disconnect', function() {
            console.log('Global Socket.IO disconnected');
        });
    });
    // Multi-cashier restaurant solution - no complex session initialization needed
    {% if current_user.is_authenticated and current_user.role.name == 'CASHIER' %}
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Cashier {{ current_user.get_full_name() }} logged in - logout protection active');
        // Ensure today session exists for logout protection tracking
        fetch('/pos/ensure_cashier_session', { method: 'POST', headers: { 'Content-Type': 'application/json' }})
            .then(r => r.json())
            .then(d => {
                if (!d.success) {
                    console.warn('Could not ensure cashier session:', d.error || d);
                }
            })
            .catch(err => console.warn('Ensure session call failed:', err));
    });
    {% endif %}
    
    // Logout prevention for cashiers who haven't printed daily report
    function checkDailyReportBeforeLogout(event) {
        event.preventDefault();
        
        // Only check for cashiers
        {% if current_user.is_authenticated and current_user.role.name == 'CASHIER' %}
        // Use server-side session tracking to check logout permission
        fetch('/pos/check_logout_permission')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.can_logout) {
                        // Allow logout
                        console.log('Logout allowed:', data.reason);
                        window.location.href = "{{ url_for('auth.logout') }}";
                    } else {
                        // Show enhanced modal based on action required
                        console.log('Logout blocked:', data.reason);
                        showEnhancedDailyReportModal(data);
                    }
                } else {
                    console.error('Error checking logout permission:', data.error);
                    // If error, allow logout as fallback
                    window.location.href = "{{ url_for('auth.logout') }}";
                }
            })
            .catch(error => {
                console.error('Error checking logout permission:', error);
                // If error, allow logout as fallback
                window.location.href = "{{ url_for('auth.logout') }}";
            });
        {% else %}
        // Non-cashiers can logout directly
        window.location.href = "{{ url_for('auth.logout') }}";
        {% endif %}
    }
    
    function showEnhancedDailyReportModal(data) {
        const actionRequired = data.action_required || 'report';
        const unpaidOrders = data.unpaid_waiter_orders || 0;
        
        let modalTitle = '';
        let modalIcon = '';
        let modalContent = '';
        let modalButtons = '';
        
        if (actionRequired === 'both') {
            modalTitle = 'Process Waiter Orders First';
            modalIcon = 'bi-exclamation-triangle-fill';
            modalContent = `
                <div class="mb-4">
                    <i class="bi bi-exclamation-triangle-fill text-danger" style="font-size: 4rem;"></i>
                </div>
                <h4 class="text-danger mb-3">🚫 Cannot Generate Report Yet</h4>
                <p class="lead mb-4">${data.reason}</p>
                <div class="alert alert-danger">
                    <strong>🚨 Required Sequence:</strong><br>
                    1. <strong>FIRST:</strong> Process or transfer ${unpaidOrders} unpaid waiter orders<br>
                    2. <strong>THEN:</strong> Generate daily report<br>
                    3. <strong>FINALLY:</strong> Logout will be available
                </div>
                <div class="alert alert-warning">
                    <strong>⚠️ Report Generation Blocked:</strong><br>
                    You cannot generate your daily report until all waiter orders are processed or transferred.
                </div>
            `;
            modalButtons = `
                <button type="button" class="btn btn-warning btn-lg me-2" onclick="goToWaiterRequests()">
                    <i class="bi bi-person-badge"></i> Process Waiter Orders First
                </button>
                <button type="button" class="btn btn-info btn-lg me-2" onclick="showTransferModal()">
                    <i class="bi bi-arrow-right-circle"></i> Transfer Orders
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> Cancel
                </button>
            `;
        } else if (actionRequired === 'waiter_orders' || actionRequired === 'waiter_orders_then_report') {
            modalTitle = 'Unpaid Waiter Orders - Report Required After';
            modalIcon = 'bi-person-badge';
            modalContent = `
                <div class="mb-4">
                    <i class="bi bi-person-badge text-warning" style="font-size: 4rem;"></i>
                </div>
                <h4 class="text-warning mb-3">👥 ${unpaidOrders} Unpaid Waiter Orders</h4>
                <p class="lead mb-4">${data.reason}</p>
                <div class="alert alert-warning">
                    <strong>📋 Required Steps:</strong><br>
                    1. Process orders and mark as paid OR transfer to another cashier<br>
                    2. Generate daily report (will be required after step 1)
                </div>
                <div class="alert alert-info">
                    <strong>ℹ️ Note:</strong> After processing/transferring orders, you'll still need to generate your daily report before logout.
                </div>
            `;
            modalButtons = `
                <button type="button" class="btn btn-warning btn-lg me-2" onclick="goToWaiterRequests()">
                    <i class="bi bi-person-badge"></i> Process Orders
                </button>
                <button type="button" class="btn btn-info btn-lg me-2" onclick="showTransferModal()">
                    <i class="bi bi-arrow-right-circle"></i> Transfer Orders
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> Cancel
                </button>
            `;
        } else {
            modalTitle = 'Daily Report Required';
            modalIcon = 'bi-file-earmark-pdf';
            modalContent = `
                <div class="mb-4">
                    <i class="bi bi-file-earmark-pdf text-danger" style="font-size: 4rem;"></i>
                </div>
                <h4 class="text-danger mb-3">📊 Daily Report Required</h4>
                <p class="lead mb-4">${data.reason}</p>
                <div class="alert alert-info">
                    <strong>📋 Report Includes:</strong><br>
                    • Today's sales and orders (including waiter orders)<br>
                    • Waiter order statistics<br>
                    • Performance breakdown
                </div>
            `;
            modalButtons = `
                <button type="button" class="btn btn-danger btn-lg me-2" onclick="generateDailyReport()">
                    <i class="bi bi-printer"></i> Generate Report
                </button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i> Cancel
                </button>
            `;
        }
        
        // Create modal HTML
        const modalHtml = `
            <div class="modal fade" id="enhancedDailyReportModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content border-danger">
                        <div class="modal-header bg-danger text-white">
                            <h5 class="modal-title">
                                <i class="bi ${modalIcon}"></i> ${modalTitle}
                            </h5>
                        </div>
                        <div class="modal-body text-center">
                            ${modalContent}
                        </div>
                        <div class="modal-footer justify-content-center">
                            ${modalButtons}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Remove existing modal if any
        const existingModal = document.getElementById('enhancedDailyReportModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        // Add modal to body
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('enhancedDailyReportModal'));
        modal.show();
    }
    
    function goToDashboard() {
        window.location.href = "{{ url_for('pos.dashboard') }}";
    }
    
    function goToWaiterRequests() {
        window.location.href = "{{ url_for('pos.waiter_requests') }}";
    }
    
    function generateDailyReport() {
        // First check if report generation is allowed
        fetch('/pos/check_report_generation_permission')
            .then(response => response.json())
            .then(data => {
                if (data.success && data.can_generate_report) {
                    // Open daily report in new tab
                    window.open("{{ url_for('pos.daily_report') }}", '_blank');
                    
                    // Close modal and show success message
                    const modal = bootstrap.Modal.getInstance(document.getElementById('enhancedDailyReportModal'));
                    if (modal) {
                        modal.hide();
                    }
                    
                    // Show success toast
                    showToast('Daily report generated successfully! You can now logout.', 'success');
                    
                    // Auto-refresh logout permission after 2 seconds
                    setTimeout(() => {
                        location.reload();
                    }, 2000);
                } else {
                    // Report generation blocked
                    const reason = data.reason || 'Cannot generate report at this time';
                    showToast(reason, 'error');
                    
                    // If there are unpaid orders, redirect to waiter requests
                    if (data.unpaid_waiter_orders > 0) {
                        setTimeout(() => {
                            window.location.href = "{{ url_for('pos.waiter_requests') }}";
                        }, 2000);
                    }
                }
            })
            .catch(error => {
                console.error('Error checking report permission:', error);
                showToast('Error checking report permission', 'error');
            });
    }
    
    function showTransferModal() {
        // First close the current modal
        const currentModal = bootstrap.Modal.getInstance(document.getElementById('enhancedDailyReportModal'));
        if (currentModal) {
            currentModal.hide();
        }
        
        // Load unpaid orders and cashiers
        Promise.all([
            fetch('/pos/get_unpaid_waiter_orders').then(r => r.json()),
            fetch('/pos/get_branch_cashiers').then(r => r.json())
        ]).then(([ordersData, cashiersData]) => {
            if (ordersData.success && cashiersData.success) {
                createTransferModal(ordersData.orders, cashiersData.cashiers);
            } else {
                showToast('Error loading transfer data', 'error');
            }
        }).catch(error => {
            console.error('Error loading transfer data:', error);
            showToast('Error loading transfer data', 'error');
        });
    }
    
    function createTransferModal(orders, cashiers) {
        if (orders.length === 0) {
            showToast('No unpaid orders to transfer', 'info');
            return;
        }
        
        if (cashiers.length === 0) {
            showToast('No other cashiers available for transfer', 'warning');
            return;
        }
        
        // Create orders list HTML
        const ordersHtml = orders.map(order => `
            <div class="form-check border rounded p-3 mb-2">
                <input class="form-check-input" type="checkbox" value="${order.id}" id="order_${order.id}">
                <label class="form-check-label w-100" for="order_${order.id}">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>#${order.order_number}</strong><br>
                            <small class="text-muted">Table ${order.table_number} • ${order.waiter_name}</small>
                        </div>
                        <div class="text-end">
                            <span class="badge bg-warning">${order.total_amount} QAR</span><br>
                            <small class="text-muted">${order.items_count} items</small>
                        </div>
                    </div>
                </label>
            </div>
        `).join('');
        
        // Create cashiers dropdown HTML
        const cashiersHtml = cashiers.map(cashier => 
            `<option value="${cashier.id}">${cashier.name} (${cashier.username})</option>`
        ).join('');
        
        const transferModalHtml = `
            <div class="modal fade" id="transferOrdersModal" tabindex="-1" data-bs-backdrop="static">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header bg-info text-white">
                            <h5 class="modal-title">
                                <i class="bi bi-arrow-right-circle"></i> Transfer Unpaid Orders
                            </h5>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-info">
                                <strong>📋 Instructions:</strong><br>
                                1. Select orders to transfer<br>
                                2. Choose target cashier<br>
                                3. Orders will be reassigned and logged
                            </div>
                            
                            <div class="row">
                                <div class="col-md-8">
                                    <h6>Select Orders to Transfer:</h6>
                                    <div class="mb-3" style="max-height: 300px; overflow-y: auto;">
                                        <div class="mb-2">
                                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllOrders()">
                                                Select All
                                            </button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="deselectAllOrders()">
                                                Deselect All
                                            </button>
                                        </div>
                                        ${ordersHtml}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <h6>Transfer To:</h6>
                                    <select class="form-select" id="targetCashier" required>
                                        <option value="">Select Cashier...</option>
                                        ${cashiersHtml}
                                    </select>
                                    
                                    <div class="mt-3">
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <h6 class="card-title">Transfer Summary</h6>
                                                <div id="transferSummary">
                                                    <span class="text-muted">Select orders to see summary</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-success" onclick="executeTransfer()">
                                <i class="bi bi-check-circle"></i> Transfer Orders
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="bi bi-x-circle"></i> Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Remove existing modal if any
        const existingModal = document.getElementById('transferOrdersModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        // Add modal to body
        document.body.insertAdjacentHTML('beforeend', transferModalHtml);
        
        // Add event listeners for dynamic summary
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateTransferSummary);
        });
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('transferOrdersModal'));
        modal.show();
    }
    
    function selectAllOrders() {
        document.querySelectorAll('#transferOrdersModal input[type="checkbox"]').forEach(cb => {
            cb.checked = true;
        });
        updateTransferSummary();
    }
    
    function deselectAllOrders() {
        document.querySelectorAll('#transferOrdersModal input[type="checkbox"]').forEach(cb => {
            cb.checked = false;
        });
        updateTransferSummary();
    }
    
    function updateTransferSummary() {
        const selectedOrders = document.querySelectorAll('#transferOrdersModal input[type="checkbox"]:checked');
        const summaryDiv = document.getElementById('transferSummary');
        
        if (selectedOrders.length === 0) {
            summaryDiv.innerHTML = '<span class="text-muted">Select orders to see summary</span>';
        } else {
            summaryDiv.innerHTML = `
                <div class="text-primary">
                    <strong>${selectedOrders.length}</strong> orders selected
                </div>
            `;
        }
    }
    
    function executeTransfer() {
        const selectedOrders = Array.from(document.querySelectorAll('#transferOrdersModal input[type="checkbox"]:checked'))
            .map(cb => parseInt(cb.value));
        const targetCashierId = document.getElementById('targetCashier').value;
        
        if (selectedOrders.length === 0) {
            showToast('Please select at least one order to transfer', 'warning');
            return;
        }
        
        if (!targetCashierId) {
            showToast('Please select a target cashier', 'warning');
            return;
        }
        
        // Show loading state
        const transferBtn = document.querySelector('#transferOrdersModal .btn-success');
        const originalText = transferBtn.innerHTML;
        transferBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Transferring...';
        transferBtn.disabled = true;
        
        // Execute transfer
        fetch('/pos/transfer_orders', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                order_ids: selectedOrders,
                target_cashier_id: parseInt(targetCashierId)
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showToast(data.message + ' Remember: You still need to generate your daily report before logout!', 'success');
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('transferOrdersModal'));
                if (modal) {
                    modal.hide();
                }
                
                // Show reminder about report requirement
                setTimeout(() => {
                    showToast('Orders transferred successfully! Now generate your daily report to logout.', 'info');
                }, 2000);
                
                // Refresh page after short delay
                setTimeout(() => {
                    location.reload();
                }, 3000);
            } else {
                showToast(data.error || 'Transfer failed', 'error');
                transferBtn.innerHTML = originalText;
                transferBtn.disabled = false;
            }
        })
        .catch(error => {
            console.error('Transfer error:', error);
            showToast('Transfer failed', 'error');
            transferBtn.innerHTML = originalText;
            transferBtn.disabled = false;
        });
    }
    
    function showToast(message, type = 'info') {
        // Create toast container if it doesn't exist
        let toastContainer = document.getElementById('toastContainer');
        if (!toastContainer) {
            toastContainer = document.createElement('div');
            toastContainer.id = 'toastContainer';
            toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
            toastContainer.style.zIndex = '9999';
            document.body.appendChild(toastContainer);
        }
        
        const toastId = 'toast_' + Date.now();
        const bgClass = type === 'success' ? 'bg-success' : type === 'error' ? 'bg-danger' : type === 'warning' ? 'bg-warning' : 'bg-info';
        
        const toastHtml = `
            <div id="${toastId}" class="toast ${bgClass} text-white" role="alert">
                <div class="toast-body">
                    ${message}
                </div>
            </div>
        `;
        
        toastContainer.insertAdjacentHTML('beforeend', toastHtml);
        
        const toastElement = document.getElementById(toastId);
        const toast = new bootstrap.Toast(toastElement, { delay: 4000 });
        toast.show();
        
        // Remove toast element after it's hidden
        toastElement.addEventListener('hidden.bs.toast', () => {
            toastElement.remove();
        });
    }
    
    // Global Sound Notification System for Cashiers
    {% if current_user.is_authenticated and current_user.role.name == 'CASHIER' %}
    // Sound generation functions
    function generateBeep(frequency = 800, duration = 200, volume = 0.3) {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = frequency;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration / 1000);
    }
    
    function playWaiterRequestSound() {
        // Play a distinctive sound pattern for waiter requests
        generateBeep(800, 200, 0.4);
        setTimeout(() => generateBeep(1000, 200, 0.4), 250);
        setTimeout(() => generateBeep(800, 200, 0.4), 500);
    }
    
    function showWaiterRequestModal(data) {
        // Remove existing modal if any
        const existingModal = document.getElementById('waiterRequestModal');
        if (existingModal) {
            existingModal.remove();
        }
        
        // Create modal HTML
        const modalHtml = `
            <div class="modal fade" id="waiterRequestModal" tabindex="-1" aria-labelledby="waiterRequestModalLabel" aria-hidden="true" data-bs-backdrop="static">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border-warning">
                        <div class="modal-header bg-warning text-dark">
                            <h5 class="modal-title" id="waiterRequestModalLabel">
                                <i class="bi bi-bell-fill me-2"></i>New Waiter Request
                            </h5>
                        </div>
                        <div class="modal-body text-center">
                            <div class="mb-3">
                                <i class="bi bi-person-raised-hand display-1 text-warning"></i>
                            </div>
                            <h4 class="text-dark mb-3">Table ${data.table_number || 'Unknown'} Needs Assistance</h4>
                            <p class="text-muted mb-4">A waiter has submitted a new request that requires your attention.</p>
                            <div class="alert alert-info">
                                <strong>Request Details:</strong><br>
                                Table: ${data.table_number || 'Unknown'}<br>
                                Time: ${new Date().toLocaleTimeString()}<br>
                                ${data.request_type ? `Type: ${data.request_type}` : ''}
                            </div>
                        </div>
                        <div class="modal-footer justify-content-center">
                            <button type="button" class="btn btn-secondary" onclick="closeWaiterRequestModal()">
                                <i class="bi bi-x-circle me-2"></i>Close
                            </button>
                            <button type="button" class="btn btn-primary" onclick="goToWaiterRequests()">
                                <i class="bi bi-arrow-right-circle me-2"></i>View Requests
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Add modal to body
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('waiterRequestModal'));
        modal.show();
        
        // Auto-close after 10 seconds if not manually closed
        setTimeout(() => {
            if (document.getElementById('waiterRequestModal')) {
                closeWaiterRequestModal();
            }
        }, 10000);
    }
    
    function closeWaiterRequestModal() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('waiterRequestModal'));
        if (modal) {
            modal.hide();
        }
        // Remove modal from DOM after hiding
        setTimeout(() => {
            const modalElement = document.getElementById('waiterRequestModal');
            if (modalElement) {
                modalElement.remove();
            }
        }, 300);
    }
    
    function goToWaiterRequests() {
        window.location.href = "{{ url_for('pos.waiter_requests') }}";
    }
    
    // Global Socket.IO listener for waiter requests - wait for socket to be initialized
    document.addEventListener('DOMContentLoaded', function() {
        // Wait for socket to be available and connected
        function setupGlobalListeners() {
            if (socket && socket.connected) {
                console.log('Setting up global sound notifications for cashier');
                
                // Listen for new waiter requests globally
                socket.on('new_waiter_request', function(data) {
                    console.log('Global: New waiter request received:', data);
                    
                    // Play sound notification
                    playWaiterRequestSound();
                    
                    // Check if we're on specific pages that should show modal
                    const currentPath = window.location.pathname;
                    const showModalPages = ['/pos/dashboard', '/pos/orders', '/pos/settings', '/cashier/settings'];
                    const shouldShowModal = showModalPages.some(page => currentPath.includes(page));
                    
                    if (shouldShowModal) {
                        // Show modal notification for specific pages
                        showWaiterRequestModal(data);
                    } else {
                        // Show toast notification for other pages
                        const message = `New waiter request from Table ${data.table_number || 'Unknown'}`;
                        showToast(message, 'info');
                    }
                    
                    // Update waiter requests badge if it exists
                    const badge = document.querySelector('.waiter-requests-badge');
                    if (badge) {
                        const currentCount = parseInt(badge.textContent) || 0;
                        badge.textContent = currentCount + 1;
                        badge.style.display = 'inline';
                    }
                });
            } else {
                // Retry after a short delay
                setTimeout(setupGlobalListeners, 100);
            }
        }
        
        // Start setting up listeners
        setupGlobalListeners();
    });
    {% endif %}
    
    // Global Sound Notification System for Waiters
    {% if current_user.is_authenticated and current_user.role.name == 'WAITER' %}
    // Sound generation function for order edit notifications
    function playOrderEditedSound() {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 600;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
        gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.2);
        gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.3);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
    }
    
    // Sound generation function for table status change (busy to free)
    function playTableFreeSound() {
        // Play a pleasant ascending chime to indicate table is now free
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // First tone (lower)
        setTimeout(() => {
            const oscillator1 = audioContext.createOscillator();
            const gainNode1 = audioContext.createGain();
            
            oscillator1.connect(gainNode1);
            gainNode1.connect(audioContext.destination);
            
            oscillator1.frequency.value = 523; // C5
            oscillator1.type = 'sine';
            
            gainNode1.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode1.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.05);
            gainNode1.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator1.start(audioContext.currentTime);
            oscillator1.stop(audioContext.currentTime + 0.3);
        }, 0);
        
        // Second tone (higher)
        setTimeout(() => {
            const oscillator2 = audioContext.createOscillator();
            const gainNode2 = audioContext.createGain();
            
            oscillator2.connect(gainNode2);
            gainNode2.connect(audioContext.destination);
            
            oscillator2.frequency.value = 659; // E5
            oscillator2.type = 'sine';
            
            gainNode2.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode2.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.05);
            gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
            
            oscillator2.start(audioContext.currentTime);
            oscillator2.stop(audioContext.currentTime + 0.4);
        }, 150);
    }
    
    // Global Socket.IO listener for order edit notifications - wait for socket to be initialized
    document.addEventListener('DOMContentLoaded', function() {
        // Wait for socket to be available and connected
        function setupWaiterGlobalListeners() {
            if (socket && socket.connected) {
                console.log('Setting up global order edit notifications for waiter');
                
                // Listen for order edit notifications from cashiers globally
                socket.on('order_edited_by_cashier', function(data) {
                    console.log('Global: Order edited by cashier event received:', data);
                    
                    // Check if this affects our branch
                    {% if current_user.branch_id %}
                    if (data.branch_id === {{ current_user.branch_id }}) {
                        // Play notification sound for waiter
                        try {
                            playOrderEditedSound();
                        } catch (error) {
                            console.log('Could not play sound:', error);
                        }
                        
                        // Show toast notification
                        const message = `Order #${data.order_number} on Table ${data.table_number} was edited by ${data.editor_name}`;
                        showToast(message, 'warning');
                    }
                    {% endif %}
                });
                
                // Listen for table status changes (busy to free) globally
                socket.on('order_paid', function(data) {
                    console.log('Global: Order paid event received:', data);
                    
                    // Check if this affects our branch
                    {% if current_user.branch_id %}
                    if (data.branch_id === {{ current_user.branch_id }}) {
                        // Play notification sound for table becoming free
                        try {
                            playTableFreeSound();
                        } catch (error) {
                            console.log('Could not play table free sound:', error);
                        }
                        
                        // Show toast notification
                        const message = `Table ${data.table_number} is now free and available for new orders`;
                        showToast(message, 'success');
                    }
                    {% endif %}
                });
            } else {
                // Retry after a short delay
                setTimeout(setupWaiterGlobalListeners, 100);
            }
        }
        
        // Start setting up listeners
        setupWaiterGlobalListeners();
    });
    {% endif %}
    
    // Fix dropdown positioning for collapsible navbar
    document.addEventListener('DOMContentLoaded', function() {
        const navbar = document.querySelector('.collapsible-navbar');
        const dropdown = document.querySelector('.collapsible-navbar .dropdown-menu');
        
        if (navbar && dropdown) {
            // Ensure dropdown appears above all content
            dropdown.style.zIndex = '10000';
            
            // Handle navbar hover state changes
            navbar.addEventListener('mouseenter', function() {
                if (dropdown.classList.contains('show')) {
                    dropdown.style.top = '60px';
                }
            });
            
            navbar.addEventListener('mouseleave', function() {
                if (dropdown.classList.contains('show')) {
                    dropdown.style.top = '25px';
                }
            });
        }
    });
    
    // Theme Toggle Function
    function toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'modal' : 'dark';
        const themeText = document.getElementById('themeText');
        const themeButton = document.getElementById('themeToggle');
        
        // Show loading state
        themeButton.disabled = true;
        themeText.textContent = 'Switching...';
        
        // Make API call to update theme preference
        fetch('{{ url_for("main.switch_theme") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ theme: newTheme })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update the theme immediately
                document.documentElement.setAttribute('data-theme', newTheme);
                themeText.textContent = newTheme === 'modal' ? 'Modal' : 'Dark';
                
                // Show success message
                showToast(`Theme switched to ${newTheme} mode`, 'success');
            } else {
                // Show error message
                showToast('Failed to switch theme: ' + (data.error || 'Unknown error'), 'danger');
                themeText.textContent = currentTheme === 'modal' ? 'Modal' : 'Dark';
            }
        })
        .catch(error => {
            console.error('Theme switch error:', error);
            showToast('Failed to switch theme. Please try again.', 'danger');
            themeText.textContent = currentTheme === 'modal' ? 'Modal' : 'Dark';
        })
        .finally(() => {
            // Re-enable button
            themeButton.disabled = false;
        });
    }
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>